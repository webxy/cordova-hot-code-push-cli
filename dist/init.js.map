{"version":3,"sources":["../src/init.js"],"names":[],"mappings":"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","file":"init.js","sourcesContent":["import es6promise from 'es6-promise';\n\nes6promise.polyfill();\n\nimport path from 'path';\nimport prompt from 'prompt';\nimport _ from 'lodash';\n\nimport { getInput, writeFile } from './utils';\n\nconst configFile = path.join(process.cwd(), 'cordova-hcp.json');\n\nconst name = {\n  description: 'Enter project name (required)',\n  pattern: /^[a-zA-Z\\-\\s0-9]+$/,\n  message: 'Name must be only letters, numbers, space or dashes',\n  required: true,\n};\n\nconst s3bucket = {\n  description: 'Amazon S3 Bucket name (required for cordova-hcp deploy)',\n  pattern: /^[a-zA-Z\\-0-9\\.]+$/,\n  message: 'Name must be only letters, numbers, or dashes',\n};\n\nconst s3prefix = {\n  description: 'Path in S3 bucket (optional for cordova-hcp deploy)',\n  pattern: /^[a-zA-Z\\-\\s0-9\\.\\/]+\\/$/,\n  message: 'Path must be only letters, numbers, spaces, forward slashes or dashes and must end with a forward slash',\n};\n\nconst s3region = {\n  description: 'Amazon S3 region (required for cordova-hcp deploy)',\n  pattern: /^(us-east-1|us-west-2|us-west-1|eu-west-1|eu-central-1|ap-southeast-1|ap-southeast-2|ap-northeast-1|sa-east-1)$/,\n  default: 'us-east-1',\n  message: 'Must be one of: us-east-1, us-west-2, us-west-1, eu-west-1, eu-central-1, ap-southeast-1, ap-southeast-2, ap-northeast-1, sa-east-1',\n};\n\nconst iosIdentifier = {\n  description: 'IOS app identifier',\n  pattern: /^[a-zA-Z\\-0-9\\.]+$/,\n};\n\nconst androidIdentifier = {\n  description: 'Android app identifier',\n  pattern: /^[a-zA-Z\\-0-9\\.]+$/,\n};\n\nconst update = {\n  description: 'Update method (required)',\n  pattern: /(start|resume|now)/,\n  required: true,\n  message: 'Needs to be one of start, resume or now',\n  default: 'resume',\n};\n\nconst schema = {\n  properties: {\n    name,\n    s3bucket,\n    s3prefix,\n    s3region,\n    ios_identifier: iosIdentifier,\n    android_identifier: androidIdentifier,\n    update,\n  },\n};\n\nconst urlSchema = {\n  properties: {\n    content_url: {\n      description: 'Enter full URL to directory where cordova-hcp build result will be uploaded',\n      message: 'Must supply URL',\n      required: true,\n    },\n  },\n};\n\nexport function execute(context) {\n  prompt.override = context.argv;\n  prompt.message = 'Please provide';\n  prompt.delimiter = ': ';\n  prompt.start();\n\n  let result;\n\n  getInput(prompt, schema)\n    .then(validateBucket)\n    .then(res => result = res)\n    .then(getUrl)\n    .then(url => _.assign(result, url))\n    .then(content => writeFile(configFile, content))\n    .then(done);\n}\n\nfunction validateBucket(result) {\n  if (!result.s3bucket) {\n    return _.omit(result, ['s3region', 's3bucket', 's3prefix']);\n  }\n\n  return result;\n}\n\nfunction getUrl({ s3region: region, s3bucket: bucket, s3prefix: path }) {\n  if (!bucket) {\n    return getInput(prompt, urlSchema);\n  }\n\n  return { content_url: getContentUrl(region, bucket, path) };\n}\n\nfunction getContentUrl(region, bucket, path) {\n  let url = region === 'us-east-1' ? 's3.amazonaws.com' : `s3-${region}.amazonaws.com`;\n  url = `https://${url}/${bucket}`\n\n  if (path) {\n    url += `/${path}`;\n  }\n\n  return url;\n}\n\nfunction done(err) {\n  if (err) {\n    return console.log(err);\n  }\n  console.log('Project initialized and cordova-hcp.json file created.');\n  console.log('If you wish to exclude files from being published, specify them in .chcpignore');\n  console.log('Before you can push updates you need to run \"cordova-hcp login\" in project directory');\n}\n"]}